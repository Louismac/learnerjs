<!DOCTYPE html>
<html>
<head>
  <script crossorigin src = "./libs/learner.v.0.4.js"></script>
  <script crossorigin src = "./libs/maxiInstruments.v.0.7.1.js"></script>
  <!-- <script crossorigin src = "https://mimicproject.com/libs/learner.v.0.4.js"></script>
  <script crossorigin src = "https://mimicproject.com/libs/maxiInstruments.v.0.7.1.js"></script> -->
  <button
    style = "margin-top:20px;margin-bottom:20px;height:30px;"
    onclick = "launchSynth()">Load Synths (User input required)
  </button>
  <div style = "width:400px;height:200px;background-color:blue;" id = "input"></div>
  <div style = "width:400px;" id = "dataset"></div>
  <div id = "synths"></div>
</head>
<body>

  <script id = "synthCode">
    class MinimalSynth extends MaxiSynthProcessorBase {

      //Called once at begining (declare custom variables)
      setup() {
        this.samples = [new Maximilian.maxiSample()]
        this.osc = new Maximilian.maxiOsc();
      }

      //Called once for every oscillator currently triggered for polyphony (every sample)
      noteSignal(envVol, index, freq, vel) {
        let signal = this.samples[freq].playOnZXAtSpeed(this.adsr[index].trigger,1.0) * envVol;
        return signal;
      }

      //Called once at end of process loop (every sample)
      endSignal(noteSignals) {
        //this.samples[0].playOnZX(this.oscillators[0].sinewave(0.01));
        //return this.samples[0].playOnZX(this.osc.sinewave(0.1));
        return [noteSignals]
      }
    }
    </script>
  <script type="text/javascript">
 	  const learner = new Learner({docId:"test"})
    learner.addGUI(document.getElementById("dataset"))
    //learner.addClassifier(3)
    // let y = [0]
    const recordXY = (event)=> {
      learner.newExample([event.clientX, event.clientY], instruments.getMappedOutputs());
    }
    document.getElementById("input").addEventListener("click", recordXY);
    //Callback for result
    learner.onOutput = (output)=> {
      //y = output
      instruments.updateMappedOutputs(output)
      console.log(output)
    };
    learner.setModelOptions({
      numHiddenNodes:8
    });


    //OUPUT
    var origin = "https://mimicproject.com/libs";
    origin = "http://127.0.0.1:4200/libs"
    const instruments = new MaxiInstruments(origin);
    var synth, sampler;
    const launchSynth = ()=> {
      instruments.guiElement = document.getElementById("synths");
      instruments.loadModules().then(()=> {
        const parameters = {
          freq:{min:40, max:400, val:100},
        }
        //Pass custom code and parameters
        synth = instruments.addSynth("synthCode", parameters);

        let origin = document.location.origin
        if(origin.includes("file"))
        {
          origin = "http://127.0.0.1:4200"
        }
        synth.loadSample(origin + "/sounds/909.wav", 0);
        const samplerSeq = [
           {freq:0, start:0, velocity:127}, //play sample 0
         ]
        synth.setSequence(samplerSeq);
        synth.setLoop(24)
      });
    }
</script>
</body>
</html>
